{"version":3,"file":"schemes.nomodule.min.js","sources":["../../packages/core/generated/scripts/config.js","../../packages/core/api.js","../../packages/schemes/src/scripts/scheme/constants.js","../../packages/schemes/src/scripts/scheme/scheme.js","../../packages/schemes/index.js","../../packages/schemes/src/scripts/switch-theme/constants.js","../../packages/schemes/src/scripts/switch-theme/switch-theme.js","../../packages/schemes/src/scripts/module.js","../../packages/schemes/src/scripts/scheme/build.js","../../packages/schemes/src/scripts/switch-theme/build.js"],"sourcesContent":["export const prefix = 'rf';\r\nexport const namespace = 'dsfr';\r\nexport const organisation = '@gouvfr';\r\n","import { namespace } from './generated/scripts/config.js';\n\nconst api = window[namespace] || {};\nwindow[namespace] = api;\nexport default api;\n","import api from '../../../api.js';\n\nconst SCHEME_ATTR = api.ns.attr('theme');\nconst TRANSITION_ATTR = api.ns.attr('transition');\n\nexport { SCHEME_ATTR, TRANSITION_ATTR };\n","import { SCHEME_ATTR, TRANSITION_ATTR } from './constants';\n\nclass Scheme {\n  constructor () {\n    this.init();\n  }\n\n  init () {\n    this.scheme = localStorage.getItem('scheme')\n      ? localStorage.getItem('scheme')\n      : null;\n\n    if (this.scheme === null) {\n      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {\n        this.scheme = 'dark';\n        localStorage.setItem('scheme', 'dark');\n      } else this.scheme = 'light';\n    }\n\n    this.root = document.documentElement;\n\n    if (this.scheme === 'dark') {\n      if (!this.root.hasAttribute(TRANSITION_ATTR)) {\n        this.root.setAttribute(SCHEME_ATTR, 'dark');\n      } else {\n        this.root.removeAttribute(TRANSITION_ATTR);\n        this.root.setAttribute(SCHEME_ATTR, 'dark');\n\n        setTimeout(() => {\n          this.root.setAttribute(TRANSITION_ATTR, '');\n        }, 300);\n      }\n    } else this.root.setAttribute(SCHEME_ATTR, 'light');\n\n    this.observer = new MutationObserver(this.mutate.bind(this));\n    this.observer.observe(this.root, { attributes: true });\n  }\n\n  mutate (mutations) {\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'attributes' && mutation.attributeName === SCHEME_ATTR) {\n        const scheme = this.root.getAttribute(SCHEME_ATTR);\n        if (scheme === 'dark') {\n          localStorage.setItem('scheme', 'dark');\n        } else if (scheme === 'light') {\n          localStorage.setItem('scheme', 'light');\n        }\n      }\n    });\n  }\n}\n\nexport { Scheme };\n","import api from './api.js';\nimport { Scheme } from './src/scripts/scheme/scheme';\n\napi.Scheme = Scheme;\n","import api from '../../../api.js';\n\nconst RADIOS_THEME_NAME = `input[name=\"${api.ns.selector('radios-theme', '')}\"]`;\nconst SWITCH_THEME_ID = api.ns.selector('switch-theme', '#');\nconst THEME_ATTR = api.ns.attr('theme');\n\nexport { RADIOS_THEME_NAME, SWITCH_THEME_ID, THEME_ATTR };\n","import { RADIOS_THEME_NAME, THEME_ATTR } from './constants';\n\nclass SwitchTheme {\n  constructor () {\n    this.attributeName = THEME_ATTR;\n    this.theme = null;\n    this.radios = document.querySelectorAll(RADIOS_THEME_NAME);\n\n    for (var i = 0; i < this.radios.length; i++) {\n      this.radios[i].addEventListener('change', this.change.bind(this));\n    }\n\n    this.observer = new MutationObserver(this.mutate.bind(this));\n    this.observe();\n    this.apply();\n  }\n\n  observe () {\n    this.observer.observe(document.documentElement, { attributes: true });\n  }\n\n  mutate (mutations) {\n    mutations.forEach((mutation) => {\n      if (mutation.type === 'attributes' && mutation.attributeName === this.attributeName) {\n        this.apply();\n      }\n    });\n  }\n\n  apply () {\n    const theme = document.documentElement.getAttribute(this.attributeName);\n    this.isApplying = true;\n    for (var i = 0; i < this.radios.length; i++) {\n      this.radios[i].checked = this.radios[i].value === theme;\n    }\n    this.isApplying = false;\n  }\n\n  change () {\n    if (this.isApplying) return;\n    if (this.observer) this.observer.disconnect();\n    this.theme = document.querySelector(RADIOS_THEME_NAME + ':checked');\n    if (this.theme) {\n      document.documentElement.setAttribute(this.attributeName, this.theme.value);\n    } else {\n      document.documentElement.removeAttribute(this.attributeName);\n    }\n    if (this.observer) this.observe();\n  }\n}\n\nexport { SwitchTheme };\n","/* eslint-disable no-new */\nimport api from '../../api.js';\nimport { SCHEME_ATTR } from './scheme/constants';\nimport { SWITCH_THEME_ID } from './switch-theme/constants';\nimport buildScheme from './scheme/build';\nimport buildSwitch from './switch-theme/build';\n\nnew api.Initializer(`:root[${SCHEME_ATTR}]`, [buildScheme]);\nnew api.Initializer(`${SWITCH_THEME_ID}`, [buildSwitch]);\n","/* eslint-disable no-new */\nimport { Scheme } from './scheme';\n\nconst build = () => {\n  new Scheme();\n};\n\nexport default build;\n","/* eslint-disable no-new */\nimport { SwitchTheme } from './switch-theme';\n\nconst build = () => {\n  new SwitchTheme();\n};\n\nexport default build;\n"],"names":["const","api","window","SCHEME_ATTR","ns","attr","TRANSITION_ATTR","Scheme","this","init","scheme","localStorage","getItem","matchMedia","matches","setItem","root","document","documentElement","hasAttribute","removeAttribute","setAttribute","setTimeout","observer","MutationObserver","mutate","bind","observe","attributes","mutations","forEach","mutation","type","attributeName","getAttribute","RADIOS_THEME_NAME","selector","SWITCH_THEME_ID","THEME_ATTR","SwitchTheme","theme","radios","querySelectorAll","i","length","addEventListener","change","apply","isApplying","checked","value","disconnect","querySelector","Initializer"],"mappings":";yBACOA,ICCDC,EAAMC,OAAgB,MAAK,GACjCA,OAAgB,KAAID,ECDpBD,IAAMG,EAAcF,EAAIG,GAAGC,KAAK,SAC1BC,EAAkBL,EAAIG,GAAGC,KAAK,cCD9BE,EACJ,WACEC,KAAKC,oBAGPA,2BACED,KAAKE,OAASC,aAAaC,QAAQ,UAC/BD,aAAaC,QAAQ,UACrB,KAEgB,OAAhBJ,KAAKE,SACHR,OAAOW,WAAW,gCAAgCC,SACpDN,KAAKE,OAAS,OACdC,aAAaI,QAAQ,SAAU,SAC1BP,KAAKE,OAAS,SAGvBF,KAAKQ,KAAOC,SAASC,gBAED,SAAhBV,KAAKE,OACFF,KAAKQ,KAAKG,aAAab,IAG1BE,KAAKQ,KAAKI,gBAAgBd,GAC1BE,KAAKQ,KAAKK,aAAalB,EAAa,QAEpCmB,uBACEd,EAAKQ,KAAKK,aAAaf,EAAiB,MACvC,MAPHE,KAAKQ,KAAKK,aAAalB,EAAa,QASjCK,KAAKQ,KAAKK,aAAalB,EAAa,SAE3CK,KAAKe,SAAW,IAAIC,iBAAiBhB,KAAKiB,OAAOC,KAAKlB,OACtDA,KAAKe,SAASI,QAAQnB,KAAKQ,KAAM,CAAEY,YAAY,iBAGjDH,gBAAQI,cACNA,EAAUC,kBAASC,GACjB,GAAsB,eAAlBA,EAASC,MAAyBD,EAASE,gBAAkB9B,EAAa,CAC5EH,IAAMU,EAASF,EAAKQ,KAAKkB,aAAa/B,GACvB,SAAXO,EACFC,aAAaI,QAAQ,SAAU,QACX,UAAXL,GACTC,aAAaI,QAAQ,SAAU,cC1CzCd,EAAIM,OAASA,ECDbP,IAAMmC,EAAoB,eAAelC,EAAIG,GAAGgC,SAAS,eAAgB,SACnEC,EAAkBpC,EAAIG,GAAGgC,SAAS,eAAgB,KAClDE,EAAarC,EAAIG,GAAGC,KAAK,SCFzBkC,EACJ,WACE/B,KAAKyB,cAAgBK,EACrB9B,KAAKgC,MAAQ,KACbhC,KAAKiC,OAASxB,SAASyB,iBAAiBP,GAExC,IAAK,IAAIQ,EAAI,EAAGA,EAAInC,KAAKiC,OAAOG,OAAQD,IACtCnC,KAAKiC,OAAOE,GAAGE,iBAAiB,SAAUrC,KAAKsC,OAAOpB,KAAKlB,OAG7DA,KAAKe,SAAW,IAAIC,iBAAiBhB,KAAKiB,OAAOC,KAAKlB,OACtDA,KAAKmB,UACLnB,KAAKuC,qBAGPpB,mBACEnB,KAAKe,SAASI,QAAQV,SAASC,gBAAiB,CAAEU,YAAY,iBAGhEH,gBAAQI,cACNA,EAAUC,kBAASC,GACK,eAAlBA,EAASC,MAAyBD,EAASE,gBAAkBzB,EAAKyB,eACpEzB,EAAKuC,wBAKXA,iBACE/C,IAAMwC,EAAQvB,SAASC,gBAAgBgB,aAAa1B,KAAKyB,eACzDzB,KAAKwC,YAAa,EAClB,IAAK,IAAIL,EAAI,EAAGA,EAAInC,KAAKiC,OAAOG,OAAQD,IACtCnC,KAAKiC,OAAOE,GAAGM,QAAUzC,KAAKiC,OAAOE,GAAGO,QAAUV,EAEpDhC,KAAKwC,YAAa,eAGpBF,kBACMtC,KAAKwC,aACLxC,KAAKe,UAAUf,KAAKe,SAAS4B,aACjC3C,KAAKgC,MAAQvB,SAASmC,cAAcjB,EAAoB,YACpD3B,KAAKgC,MACPvB,SAASC,gBAAgBG,aAAab,KAAKyB,cAAezB,KAAKgC,MAAMU,OAErEjC,SAASC,gBAAgBE,gBAAgBZ,KAAKyB,eAE5CzB,KAAKe,UAAUf,KAAKmB,YCxC5B,IAAI1B,EAAIoD,qBAAqBlD,MAAgB,YCH3C,IAAII,KDIN,IAAIN,EAAIoD,eAAehB,EAAmB,YEJxC,IAAIE"}